<html xmlns="http://www.w3.org/1999/xhtml" class="ui-draggable" style="position: relative;"><head class="ui-draggable" style="position: relative;">
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" class="ui-draggable" style="position: relative;">
		<title class="ui-draggable" style="position: relative;">Scott Creek Scoreboard</title>
		<link href="viewstyles.css" rel="stylesheet" type="text/css" class="ui-draggable" style="position: relative;">

	</head>
	<body class="ui-draggable" style="position: relative; cursor: auto; left: -1px; top: -1px; color: white;">

		<div id="background" class="ui-draggable" style="left: 255px; top: -97px;">
    <img src="images/scorebackreal.png" style="z-index: -1; left: 25px; top: 108px; position: relative;" class="ui-draggable noclick">
			<div id="Time" class="time ui-draggable doubleDigitsTime" style=" display: block;">
				<span id="minutesSlot" class="ui-draggable noclick" style="position: relative; left: 436px; top: 55px;">10</span>
				<span id="timeSeparator" class="ui-draggable noclick" style="position: relative; left: 415px; top: 45px;">:</span>
				<span id="secondsSlot" class="ui-draggable noclick" style="position: relative; left: 395px; top: 53px;">55</span>
			
			
			</div>

			
			<div class="period ui-draggable" style="position: relative; display: block;">
				<div id="LabelPeriod" class="ui-draggable"><img src="images/LabelPeriod.png" class="ui-draggable noclick" style="position: relative; left: -228px; top: 142px;"></div>
				<div id="Period" class="ui-draggable ConvertedToSingleDigits" style="left: 331px;"><h2 class="smallerText ui-draggable noclick" style="position: relative; left: 672px; top: -759.74px;">9</h2></div>
				
				
			</div>
			<div class="fouls ui-draggable" style="position: relative;">
			<div id="LabelFouls" class="ui-draggable"><img src="images/LabelFouls.png" class="ui-draggable noclick" style="position: relative; left: -286px; top: -270px;"></div>
			
			
			
			
			<div id="LabelFoulsHome" class="ui-draggable"><img src="images/LabelFouls.png" class="ui-draggable" style="position: relative;"></div>
			

			<div id="FoulsGuest" class="ui-draggable ConvertedToSingleDigits" style="left: 54px;"><h2 class="smallerText ui-draggable noclick" style="position: relative; left: 201px; top: -438.74px;">9</h2></div>

			<div id="FoulsHome" class="ui-draggable ConvertedToDoubleDigits" style="left: 597px;"><h2 class="smallerText ui-draggable noclick" style="position: relative; left: 783px; top: -439.74px;">10</h2></div>
			
			</div>
			<div class="timeouts ui-draggable" style="position: relative;">
			<div id="HomeLabelTimeouts" class="ui-draggable"><img src="images/HomeLabelTimeouts.png" class="ui-draggable" style="position: relative;"></div>
			<div id="HomeTimeouts" class="ui-draggable ConvertedToSingleDigits" style="left: 380px;"><h2 class="smallerText ui-draggable noclick" style="position: relative; left: 676px; top: -555.74px;">9</h2></div>
	

			<div id="GuestLabelTimeouts" class="ui-draggable"><img src="images/GuestLabelTimeouts.png" class="ui-draggable" style="position: relative;"></div>
			<div id="GuestTimeouts" class="ui-draggable ConvertedToSingleDigits" style="left: 272px;"><h2 class="smallerText ui-draggable noclick" style="position: relative; left: 329px; top: -554.74px;">9</h2></div>
			
			</div>
			<div class="score ui-draggable" style="position: relative; display: block;">
			<div id="LabelHome" class="ui-draggable"><img src="images/LabelHome.png" class="ui-draggable" style="position: relative;"></div>
			<div id="HomeScore" class="ui-draggable ConvertedToSingleDigits" style="left: 462px;"><h2 class="Scores ui-draggable noclick" style="position: relative; left: 923px; top: -1034.46px;">9</h2></div>
			
			
			<div id="LabelGuest" class="ui-draggable"><img src="images/LabelGuest.png" class="ui-draggable" style="position: relative;"></div>
			<div id="ScoreGuest" class="ui-draggable ConvertedToSingleDigits" style="left: 147px;"><h2 class="Scores ui-draggable noclick" style="position: relative; left: 75px; top: -1033.46px; color: white;">6</h2></div>
			</div>
			
	<form method="post" id="PossessionForm" class="ui-draggable">
		      	<legend id="Possession" class="ui-draggable"><img src="images/possession.png" class="ui-draggable noclick" style="position: relative; left: -204px; top: 492px;"></legend>     
		      	<label for="GUESTPOS" class="btnPos" style="position: relative; left: 50px; top: -422px;"><img src="images/leftarrow.png" class="ui-draggable noclick" style="width: 2.5%; position: relative; left: -218px; top: 18px;"></label>
		        <input type="radio" name="Possession" id="GUESTPOS" value="GUESTPOS" class="ui-draggable" style="position: relative;">
		        <label for="HOMEPOS" class="btnPosClicked" style="position: relative; left: -744px; top: -419px;"><img src="images/rightarrow.png" class="ui-draggable noclick" style="width: 2.5%; position: relative; left: 1511px; top: 13px;"></label>
		        <input type="radio" name="Possession" id="HOMEPOS" value="HOMEPOS" class="ui-draggable" style="position: relative;">
		        
    </form>
				
	

</div>			



			


	<script src="https://cdn.socket.io/socket.io-1.2.0.js" class="ui-draggable" style="position: relative;"></script>
    <script src="http://code.jquery.com/jquery-1.11.1.js" class="ui-draggable" style="position: relative;"></script>
	<script class="ui-draggable" style="position: relative;">
	var isPaused;
	var isTextArea;
	var isUnderMin;
	var time;
	var  oldTime = Date.now();

	    $(document).ready(function() {
		        var socket = io();


		        //PING
		        
/*
				socket.on('disconnect', function(){
				        console.log('user disconnected');
				});
		        setInterval(function() {
  					startTime = Date.now();
  					socket.emit('ping');
				}, 2000);

				socket.on('pong', function() {
				  latency = Date.now() - startTime;
				  console.log(latency);
				});
*/
				//HOME SCORE		       
	     
		        socket.on('HomeScoreChange', function(new_score){		         
		          $('#HomeScore').children('h2').html(new_score);
		        
		        });

		        //GUEST SCORE
	     
		       socket.on('GuestScoreChange', function(new_score){		      		   
		          $('#ScoreGuest').children('h2').html(new_score);

		       });
		       // FOULS HOME
	     
		       socket.on('HomeFoulChange', function(new_score){		      		   
		          $('#FoulsHome').children('h2').html(new_score);
		       });
	     
		       socket.on('GuestFoulChange', function(new_score){		      		   
		          $('#FoulsGuest').children('h2').html(new_score);
		       });
		       // TIMEOUTS HOME

	     
		       socket.on('HomeTimeoutChange', function(new_score){		      		   
		          $('#HomeTimeouts').children('h2').html(new_score);
		       });

	     
		       socket.on('GuestTimeoutChange', function(new_score){		      		   
		          $('#GuestTimeouts').children('h2').html(new_score);
		       });

		       // PEROIOD

		       socket.on('PeriodChange', function(new_score){		      		   
		          $('#Period').children('h2').html(new_score);
		       });	



		       socket.on("TimePlay", function(newtime){
		       	time = newtime;
		       		Play();
		       });
		       
		       
		       socket.on('TimePause', function(newtime){
		       	time = newtime;
				Pause();
		       });
		       	
		    	socket.on('TimeChange', function(newtime){
		    		time = newtime;
		    		
		    	});

		    	socket.on('SeparatorChange', function(newIsUnderMin){
		    		isUnderMin = newIsUnderMin;
		    	});

		    	
				socket.on('toggleField', function(data){
					toggle(data.elementClass, data.isVisible);

				});
		    	
		       socket.on("start", function(){
		       	console.log("START");
		       		if (parseInt($('#Period').children('h2').text()) >= 10) {
		       			//convertToDoubleDigits('#Period');
		       			$('#Period').addClass("ConvertedToDoubleDigits");
		       			$('#Period').removeClass('ConvertedToSingleDigits');
		       		}	
		       		if (parseInt($('#Period').children('h2').text()) <= 9) {
		       			//	convertToSingleDigits('#Period');
		       			$('#Period').addClass("ConvertedToSingleDigits");
		       			$('#Period').removeClass('ConvertedToDoubleDigits');
		       		}	

		       		if (parseInt($('#GuestTimeouts').children('h2').text()) >= 10) {
		       			//convertToDoubleDigits('#Period');
		       			$('#GuestTimeouts').addClass("ConvertedToDoubleDigits");
		       			$('#GuestTimeouts').removeClass('ConvertedToSingleDigits');
		       		}	
		       		if (parseInt($('#GuestTimeouts').children('h2').text()) <= 9) {
		       			//	convertToSingleDigits('#Period');
		       			$('#GuestTimeouts').addClass("ConvertedToSingleDigits");
		       			$('#GuestTimeouts').removeClass('ConvertedToDoubleDigits');
		       		}

		       		if (parseInt($('#HomeTimeouts').children('h2').text()) >= 10) {
		       			//convertToDoubleDigits('#Period');
		       			$('#HomeTimeouts').addClass("ConvertedToDoubleDigits");
		       			$('#HomeTimeouts').removeClass('ConvertedToSingleDigits');
		       		}	
		       		if (parseInt($('#HomeTimeouts').children('h2').text()) <= 9) {
		       			//	convertToSingleDigits('#Period');
		       			$('#HomeTimeouts').addClass("ConvertedToSingleDigits");
		       			$('#HomeTimeouts').removeClass('ConvertedToDoubleDigits');
		       		}

		       		if (parseInt($('#FoulsGuest').children('h2').text()) >= 10) {
		       			//convertToDoubleDigits('#Period');
		       			$('#FoulsGuest').addClass("ConvertedToDoubleDigits");
		       			$('#FoulsGuest').removeClass('ConvertedToSingleDigits');
		       		}	
		       		if (parseInt($('#FoulsGuest').children('h2').text()) <= 9) {
		       			//	convertToSingleDigits('#Period');
		       			$('#FoulsGuest').addClass("ConvertedToSingleDigits");
		       			$('#FoulsGuest').removeClass('ConvertedToDoubleDigits');
		       		}

		       		if (parseInt($('#FoulsHome').children('h2').text()) >= 10) {
		       			//convertToDoubleDigits('#Period');
		       			$('#FoulsHome').addClass("ConvertedToDoubleDigits");
		       			$('#FoulsHome').removeClass('ConvertedToSingleDigits');
		       		}	
		       		if (parseInt($('#FoulsHome').children('h2').text()) <= 9) {
		       			//	convertToSingleDigits('#Period');
		       			$('#FoulsHome').addClass("ConvertedToSingleDigits");
		       			$('#FoulsHome').removeClass('ConvertedToDoubleDigits');
		       		}

		       		if (parseInt($('#HomeScore').children('h2').text()) >= 10) {
		       			//convertToDoubleDigits('#Period');
		       			$('#HomeScore').addClass("ConvertedToDoubleDigits");
		       			$('#HomeScore').removeClass('ConvertedToSingleDigits');
		       		}	
		       		if (parseInt($('#HomeScore').children('h2').text()) <= 9) {
		       			//	convertToSingleDigits('#Period');
		       			$('#HomeScore').addClass("ConvertedToSingleDigits");
		       			$('#HomeScore').removeClass('ConvertedToDoubleDigits');
		       		}

		       		if (parseInt($('#ScoreGuest').children('h2').text()) >= 10) {
		       			//convertToDoubleDigits('#Period');
		       			$('#ScoreGuest').addClass("ConvertedToDoubleDigits");
		       			$('#ScoreGuest').removeClass('ConvertedToSingleDigits');
		       		}	
		       		if (parseInt($('#ScoreGuest').children('h2').text()) <= 9) {
		       			//	convertToSingleDigits('#Period');
		       			$('#ScoreGuest').addClass("ConvertedToSingleDigits");
		       			$('#ScoreGuest').removeClass('ConvertedToDoubleDigits');
		       		}		       		

		       });

		       





		       function convertToDoubleDigits(name) {
		       	if ($(name).hasClass('ConvertedToDoubleDigits')) {
		       		return;
		       	}
		       	console.log('converting to double digits');
		       	$(name).addClass("ConvertedToDoubleDigits");
		       	$(name).removeClass('ConvertedToSingleDigits');
		       	var amount = 32;
		       	if(name == "#HomeScore" || name == '#ScoreGuest'){
		       		amount= 50;
		       	}

		       	$(name).css('left', parseInt($(name).css('left')) - amount );

		       }

		       function convertToSingleDigits(name) {
		       	if ($(name).hasClass('ConvertedToSingleDigits')) {
					return;
		       	}

		       	console.log('Converiting ti single digits');
		       	$(name).addClass("ConvertedToSingleDigits");
		       	$(name).removeClass('ConvertedToDoubleDigits');
		       	var amount = 32;
		       	if(name == "#HomeScore" || name == '#ScoreGuest'){
		       		amount= 50;
		       	}
		       	console.log(amount);
		      	 $(name).css('left',parseInt($(name).css('left') ) + amount);
		       }
		       setTimeout(function(){
			       setInterval(function(){
			       		if (parseInt($('#Period').children('h2').text()) >= 10) {
			       			convertToDoubleDigits('#Period');
			       		}	
			       		if (parseInt($('#Period').children('h2').text()) <= 9) {
			       			convertToSingleDigits('#Period');
			       		}	
			       		
			       		if (parseInt($('#GuestTimeouts').children('h2').text()) >= 10) {
			       			convertToDoubleDigits('#GuestTimeouts');
			       		}	
			       		if (parseInt($('#GuestTimeouts').children('h2').text()) <= 9) {
			       			convertToSingleDigits('#GuestTimeouts');
			       		}	

			       		if (parseInt($('#HomeTimeouts').children('h2').text()) >= 10) {
			       			convertToDoubleDigits('#HomeTimeouts');
			       		}	
			       		if (parseInt($('#HomeTimeouts').children('h2').text()) <= 9) {
			       			convertToSingleDigits('#HomeTimeouts');
			       		}	


			       		if (parseInt($('#FoulsGuest').children('h2').text()) >= 10) {
			       			convertToDoubleDigits('#FoulsGuest');
			       		}	
			       		if (parseInt($('#FoulsGuest').children('h2').text()) <= 9) {
			       			convertToSingleDigits('#FoulsGuest');
			       		}

			       		if (parseInt($('#FoulsHome').children('h2').text()) >= 10) {
			       			convertToDoubleDigits('#FoulsHome');
			       		}	
			       		if (parseInt($('#FoulsHome').children('h2').text()) <= 9) {
			       			convertToSingleDigits('#FoulsHome');
			       		}


			       		if (parseInt($('#ScoreGuest').children('h2').text()) >= 10) {
			       			convertToDoubleDigits('#ScoreGuest');
			       		}	
			       		if (parseInt($('#HomeScore').children('h2').text()) <= 9) {
			       			convertToSingleDigits('#HomeScore');
			       		}

			       		if (parseInt($('#HomeScore').children('h2').text()) >= 10) {
			       			convertToDoubleDigits('#HomeScore');
			       		}	
			       		if (parseInt($('#ScoreGuest').children('h2').text()) <= 9) {
			       			convertToSingleDigits('#ScoreGuest');
			       		}


			       }, 100);

			    },500);






				socket.on('Possession', function(data){
					console.log("I GOT " + data);
					if (data == 'Home') {
						console.log("SETTINg HOME");
						$("label[for='HOMEPOS']").prop('class','btnPosClicked');
						$("label[for='GUESTPOS']").prop('class', 'btnPos');
					}
					if (data == 'Guest') {
						console.log("SETTING GUEST");
						$("label[for='GUESTPOS']").prop('class', 'btnPosClicked');
						$("label[for='HOMEPOS']").prop('class', 'btnPos' );

				}
					
					
					

				});
	});
				
				//



		       function parseScore(socoreText, operation) {
		          var old_score_int = parseInt(socoreText);
		          if (operation == "+"){var new_score = old_score_int + 1};
		          if (operation == "-"){var new_score = old_score_int - 1};
		          if(new_score < 0){new_score = 0};
		          
		          return new_score;
		        }

		        document.addEventListener('gesturestart', function (e) {
    				e.preventDefault();
				});





				function Reset(){
					socket.emit('reset');

				}

				//Hide Code


				function toggle(elementClass, isVisible){
					console.log(elementClass);
					console.log(isVisible);
					if(isVisible){
						$('.' + elementClass).fadeIn();
						$('*[data-a="'+ elementClass+'"]').addClass('checked');
						
						
						
					}
					else if(!isVisible){
						$('.' + elementClass).fadeOut();
						$('*[data-a="'+ elementClass+'"]').removeClass('checked');
					}

				}



	
function Pause(){
	$('#Pause').fadeOut("100");
	$('#Play').fadeIn("100");
	isPaused=true;
	
}
function Play(){
	$('#Play').fadeOut("100");
	$('#Pause').fadeIn("100");
	oldTime = Date.now();
	isPaused=false;
	
}	


function ToTextArea(id){
	if(isTextArea)
		return;
	$('#Play').hide();
	$('#Pause').hide();
	$('#save').show();
	$('#Time').css("left", "138px");
	$('#Time').css("top", "-1px");
	
	
	isTextArea = true;
	var textm = $('#minutesSlot').text();
	var texts = $('#secondsSlot').text();
	$('#secondsSlot').html('<textarea class="textsecondsSlot">' + texts+'</textarea>');
	$('#minutesSlot').html('<textarea class="textminutesSlot">'+textm+' </textarea>');
	$('#timeSeparator').addClass("btn");
}

var oldTime = Date.now();
		setInterval(function(){
		
		if(isPaused){

			return
		}

		if(Math.floor(time - (Date.now()- oldTime)) <= 0){time = 0}else{
			time = time - (Date.now()- oldTime);
		}
		
		oldTime = Date.now();
	}, 100);

//UPDATE THE BOARD
//TODO change the times postion if double digits
	setInterval(function(){

		if(isTextArea){
			return
		}

		var timeObject =  convertMillisecondsToDigitalClock(time);
		if (timeObject.minutes >= 10 && timeObject.seconds >= 10) {
			
			$('#Time').addClass('doubleDigitsTime');
		}else{
			$('#Time').removeClass('doubleDigitsTime');
		}
		if (timeObject.minutes >= 10 && timeObject.seconds < 10) {
			
			$('#Time').addClass('doubleDigitsTimeSeconds');
		}else{
			$('#Time').removeClass('doubleDigitsTimeSeconds');
		}
		if (timeObject.minutes <10 && timeObject.seconds >= 10){
			$('#Time').addClass('doubleDigitsTimeSecondsMinutesSingle');
		}else{
			$('#Time').removeClass('doubleDigitsTimeSecondsMinutesSingle');

		}
		if (timeObject.minutes ==0 && timeObject.seconds ==0){
			$('#Time').addClass('timeZero');
		}else{
			$('#Time').removeClass('timeZero');

		}
		if (timeObject.minutes == 0) {
			isUnderMin = true;
			$('#minutesSlot').text(timeObject.seconds);
			$('#secondsSlot').text(timeObject.tenthseconds);
			$('#Time').css('left', '237');
			$('#timeSeparator').text('.');
			
			return;
		}
		isUnderMin = false;
		$('#timeSeparator').text(':');
		$('#minutesSlot').text(timeObject.minutes);
		$('#secondsSlot').text(timeObject.seconds);

	}, 100);



	// CONVERT MILLISECONDS TO DIGITAL CLOCK FORMAT
	function convertMillisecondsToDigitalClock(ms) {
	    var hours = Math.floor(ms / 3600000); // 1 Hour = 36000 Milliseconds
	    var minutes = Math.floor(ms  / 60000); // 1 Minutes = 60000 Milliseconds
	    var seconds = Math.floor(((ms % 360000) % 60000) / 1000) ;	// 1 Second = 1000 Milliseconds
	    var tenthseconds = Math.floor((((ms % 360000) % 60000) % 1000) / 100);
	    var miliseconds = (((ms % 360000) % 60000) % 1000);
	        return {
		        hours : hours,
		        minutes : minutes,
		        seconds : seconds,
		        miliseconds:miliseconds,
		        tenthseconds: tenthseconds,
		        clock : hours + ":" + minutes + ":" + seconds + "." + tenthseconds
	    	};
	}



    </script>
 
 <script id="pb_blockScript" class="ui-draggable" style="position: relative;">function inject() {
		var originalOpenWndFnKey = "originalOpenFunction";
		var originalWindowOpenFn = window.open;
		var originalCreateElementFn = document.createElement;
		var originalCreateEventFn = document.createEvent;
		var windowsWithNames = {};
		var timeSinceCreateAElement = 0;
		var lastCreatedAElement = null;
		var fullScreenOpenTime = void 0;
		var parentOrigin = window.location != window.parent.location ? document.referrer : document.location;

		window[originalOpenWndFnKey] = window.open; // save the original open window as global param
		function newWindowOpenFn() {
			var openWndArguments = arguments;
			var useOriginalOpenWnd = true;
			var generatedWindow = null;

			function blockedWndNotification(openWndArguments) {
				parent.postMessage({ type: "blockedWindow", args: JSON.stringify(openWndArguments) }, parentOrigin);
			}

			function getWindowName(openWndArguments) {
				var windowName = openWndArguments[1];
				if (windowName != null && !["_blank", "_parent", "_self", "_top"].includes(windowName)) {
					return windowName;
				}

				return null;
			}

			function copyMissingProperties(src, dest) {
				var prop = void 0;
				for (prop in src) {
					try {
						if (dest[prop] === undefined && src[prop]) {
							dest[prop] = src[prop];
						}
					} catch (e) {}
				}
				return dest;
			}

			// the element who registered to the event
			var capturingElement = null;
			if (window.event != null) {
				capturingElement = window.event.currentTarget;
			}

			if (capturingElement == null) {
				var caller = openWndArguments.callee;
				while (caller.arguments != null && caller.arguments.callee.caller != null) {
					caller = caller.arguments.callee.caller;
				}
				if (caller.arguments != null && caller.arguments.length > 0 && caller.arguments[0].currentTarget != null) {
					capturingElement = caller.arguments[0].currentTarget;
				}
			}

			/////////////////////////////////////////////////////////////////////////////////
			// Blocked if a click on background element occurred (<body> or document)
			/////////////////////////////////////////////////////////////////////////////////

			if (capturingElement != null && (capturingElement instanceof Window || capturingElement === document || capturingElement.URL != null && capturingElement.body != null || capturingElement.nodeName != null && (capturingElement.nodeName.toLowerCase() == "body" || capturingElement.nodeName.toLowerCase() == "#document"))) {
				window.pbreason = "Blocked a new window opened with URL: " + openWndArguments[0] + " because it was triggered by the " + capturingElement.nodeName + " element";
				useOriginalOpenWnd = false;
			} else {
				useOriginalOpenWnd = true;
			}
			/////////////////////////////////////////////////////////////////////////////////


			/////////////////////////////////////////////////////////////////////////////////
			// Block if a full screen was just initiated while opening this url.
			/////////////////////////////////////////////////////////////////////////////////

			var fullScreenElement = document.webkitFullscreenElement || document.mozFullscreenElement || document.fullscreenElement;
			if (new Date().getTime() - fullScreenOpenTime < 1000 || isNaN(fullScreenOpenTime) && isDocumentInFullScreenMode()) {

				window.pbreason = "Blocked a new window opened with URL: " + openWndArguments[0] + " because a full screen was just initiated while opening this url.";

				/* JRA REMOVED
	    if (window[script_params.fullScreenFnKey]) {
	    window.clearTimeout(window[script_params.fullScreenFnKey]);
	    }
	    */

				if (document.exitFullscreen) {
					document.exitFullscreen();
				} else if (document.mozCancelFullScreen) {
					document.mozCancelFullScreen();
				} else if (document.webkitCancelFullScreen) {
					document.webkitCancelFullScreen();
				}

				useOriginalOpenWnd = false;
			}
			/////////////////////////////////////////////////////////////////////////////////


			if (useOriginalOpenWnd == true) {
				generatedWindow = originalWindowOpenFn.apply(this, openWndArguments);
				// save the window by name, for latter use.
				var windowName = getWindowName(openWndArguments);
				if (windowName != null) {
					windowsWithNames[windowName] = generatedWindow;
				}

				// 2nd line of defence: allow window to open but monitor carefully...

				/////////////////////////////////////////////////////////////////////////////////
				// Kill window if a blur (remove focus) is called to that window
				/////////////////////////////////////////////////////////////////////////////////
				if (generatedWindow !== window) {
					(function () {
						var openTime = new Date().getTime();
						var originalWndBlurFn = generatedWindow.blur;
						generatedWindow.blur = function () {
							if (new Date().getTime() - openTime < 1000 /* one second */) {
									window.pbreason = "Blocked a new window opened with URL: " + openWndArguments[0] + " because a it was blured";
									generatedWindow.close();
									blockedWndNotification(openWndArguments);
								} else {
								originalWndBlurFn();
							}
						};
					})();
				}
				/////////////////////////////////////////////////////////////////////////////////
			} else {
				var windowName;

				(function () {
					// (useOriginalOpenWnd == false)

					var location = {
						href: openWndArguments[0]
					};
					location.replace = function (url) {
						location.href = url;
					};

					generatedWindow = {
						close: function close() {
							return true;
						},
						test: function test() {
							return true;
						},
						blur: function blur() {
							return true;
						},
						focus: function focus() {
							return true;
						},
						showModelessDialog: function showModelessDialog() {
							return true;
						},
						showModalDialog: function showModalDialog() {
							return true;
						},
						prompt: function prompt() {
							return true;
						},
						confirm: function confirm() {
							return true;
						},
						alert: function alert() {
							return true;
						},
						moveTo: function moveTo() {
							return true;
						},
						moveBy: function moveBy() {
							return true;
						},
						resizeTo: function resizeTo() {
							return true;
						},
						resizeBy: function resizeBy() {
							return true;
						},
						scrollBy: function scrollBy() {
							return true;
						},
						scrollTo: function scrollTo() {
							return true;
						},
						getSelection: function getSelection() {
							return true;
						},
						onunload: function onunload() {
							return true;
						},
						print: function print() {
							return true;
						},
						open: function open() {
							return this;
						},

						opener: window,
						closed: false,
						innerHeight: 480,
						innerWidth: 640,
						name: openWndArguments[1],
						location: location,
						document: { location: location }
					};

					copyMissingProperties(window, generatedWindow);

					generatedWindow.window = generatedWindow;

					windowName = getWindowName(openWndArguments);

					if (windowName != null) {
						try {
							// originalWindowOpenFn("", windowName).close();
							windowsWithNames[windowName].close();
						} catch (err) {}
					}
					//why set timeout?
					setTimeout(function () {
						var url = void 0;
						if (!(generatedWindow.location instanceof Object)) {
							url = generatedWindow.location;
						} else if (!(generatedWindow.document.location instanceof Object)) {
							url = generatedWindow.document.location;
						} else if (location.href != null) {
							url = location.href;
						} else {
							url = openWndArguments[0];
						}
						openWndArguments[0] = url;
						blockedWndNotification(openWndArguments);
					}, 100);
				})();
			}

			return generatedWindow;
		}

		/////////////////////////////////////////////////////////////////////////////////
		// Replace the window open method with Poper Blocker's
		/////////////////////////////////////////////////////////////////////////////////
		window.open = function () {
			try {
				return newWindowOpenFn.apply(this, arguments);
			} catch (err) {
				return null;
			}
		};
		/////////////////////////////////////////////////////////////////////////////////


		//////////////////////////////////////////////////////////////////////////////////////////////////////////
		// Monitor dynamic html element creation to prevent generating <a> elements with click dispatching event
		//////////////////////////////////////////////////////////////////////////////////////////////////////////
		document.createElement = function () {

			var newElement = originalCreateElementFn.apply(document, arguments);

			if (arguments[0] == "a" || arguments[0] == "A") {
				(function () {

					timeSinceCreateAElement = new Date().getTime();

					var originalDispatchEventFn = newElement.dispatchEvent;

					newElement.dispatchEvent = function (event) {
						if (event.type != null && ("" + event.type).toLocaleLowerCase() == "click") {
							window.pbreason = "blocked due to an explicit dispatchEvent event with type 'click' on an 'a' tag";
							parent.postMessage({
								type: "blockedWindow",
								args: JSON.stringify({ "0": newElement.href })
							}, parentOrigin);
							return true;
						}

						return originalDispatchEventFn(event);
					};

					lastCreatedAElement = newElement;
				})();
			}

			return newElement;
		};
		/////////////////////////////////////////////////////////////////////////////////


		/////////////////////////////////////////////////////////////////////////////////
		// Block artificial mouse click on frashly created <a> elements
		/////////////////////////////////////////////////////////////////////////////////
		document.createEvent = function () {
			try {
				if (arguments[0].toLowerCase().includes("mouse") && new Date().getTime() - timeSinceCreateAElement <= 50) {
					window.pbreason = "Blocked because 'a' element was recently created and " + arguments[0] + " event was created shortly after";
					arguments[0] = lastCreatedAElement.href;
					parent.postMessage({
						type: "blockedWindow",
						args: JSON.stringify({ "0": lastCreatedAElement.href })
					}, parentOrigin);
					return null;
				}
				return originalCreateEventFn.apply(document, arguments);
			} catch (err) {}
		};
		/////////////////////////////////////////////////////////////////////////////////


		/////////////////////////////////////////////////////////////////////////////////
		// Monitor full screen requests
		/////////////////////////////////////////////////////////////////////////////////
		function onFullScreen(isInFullScreenMode) {
			if (isInFullScreenMode) {
				fullScreenOpenTime = new Date().getTime();
			} else {
				fullScreenOpenTime = NaN;
			}
		}

		/////////////////////////////////////////////////////////////////////////////////

		function isDocumentInFullScreenMode() {
			// Note that the browser fullscreen (triggered by short keys) might
			// be considered different from content fullscreen when expecting a boolean
			return document.fullScreenElement && document.fullScreenElement !== null || // alternative standard methods
			document.mozFullscreenElement != null || document.webkitFullscreenElement != null; // current working methods
		}

		document.addEventListener("fullscreenchange", function () {
			onFullScreen(document.fullscreen);
		}, false);

		document.addEventListener("mozfullscreenchange", function () {
			onFullScreen(document.mozFullScreen);
		}, false);

		document.addEventListener("webkitfullscreenchange", function () {
			onFullScreen(document.webkitIsFullScreen);
		}, false);
	}</script><script class="ui-draggable" style="position: relative;">inject()</script></body><script id="pb_blockScript" class="ui-draggable" style="position: relative;">function inject() {
		var originalOpenWndFnKey = "originalOpenFunction";
		var originalWindowOpenFn = window.open;
		var originalCreateElementFn = document.createElement;
		var originalCreateEventFn = document.createEvent;
		var windowsWithNames = {};
		var timeSinceCreateAElement = 0;
		var lastCreatedAElement = null;
		var fullScreenOpenTime = void 0;
		var parentOrigin = window.location != window.parent.location ? document.referrer : document.location;

		window[originalOpenWndFnKey] = window.open; // save the original open window as global param
		function newWindowOpenFn() {
			var openWndArguments = arguments;
			var useOriginalOpenWnd = true;
			var generatedWindow = null;

			function blockedWndNotification(openWndArguments) {
				parent.postMessage({ type: "blockedWindow", args: JSON.stringify(openWndArguments) }, parentOrigin);
			}

			function getWindowName(openWndArguments) {
				var windowName = openWndArguments[1];
				if (windowName != null && !["_blank", "_parent", "_self", "_top"].includes(windowName)) {
					return windowName;
				}

				return null;
			}

			function copyMissingProperties(src, dest) {
				var prop = void 0;
				for (prop in src) {
					try {
						if (dest[prop] === undefined && src[prop]) {
							dest[prop] = src[prop];
						}
					} catch (e) {}
				}
				return dest;
			}

			// the element who registered to the event
			var capturingElement = null;
			if (window.event != null) {
				capturingElement = window.event.currentTarget;
			}

			if (capturingElement == null) {
				var caller = openWndArguments.callee;
				while (caller.arguments != null && caller.arguments.callee.caller != null) {
					caller = caller.arguments.callee.caller;
				}
				if (caller.arguments != null && caller.arguments.length > 0 && caller.arguments[0].currentTarget != null) {
					capturingElement = caller.arguments[0].currentTarget;
				}
			}

			/////////////////////////////////////////////////////////////////////////////////
			// Blocked if a click on background element occurred (<body> or document)
			/////////////////////////////////////////////////////////////////////////////////

			if (capturingElement != null && (capturingElement instanceof Window || capturingElement === document || capturingElement.URL != null && capturingElement.body != null || capturingElement.nodeName != null && (capturingElement.nodeName.toLowerCase() == "body" || capturingElement.nodeName.toLowerCase() == "#document"))) {
				window.pbreason = "Blocked a new window opened with URL: " + openWndArguments[0] + " because it was triggered by the " + capturingElement.nodeName + " element";
				useOriginalOpenWnd = false;
			} else {
				useOriginalOpenWnd = true;
			}
			/////////////////////////////////////////////////////////////////////////////////


			/////////////////////////////////////////////////////////////////////////////////
			// Block if a full screen was just initiated while opening this url.
			/////////////////////////////////////////////////////////////////////////////////

			var fullScreenElement = document.webkitFullscreenElement || document.mozFullscreenElement || document.fullscreenElement;
			if (new Date().getTime() - fullScreenOpenTime < 1000 || isNaN(fullScreenOpenTime) && isDocumentInFullScreenMode()) {

				window.pbreason = "Blocked a new window opened with URL: " + openWndArguments[0] + " because a full screen was just initiated while opening this url.";

				/* JRA REMOVED
	    if (window[script_params.fullScreenFnKey]) {
	    window.clearTimeout(window[script_params.fullScreenFnKey]);
	    }
	    */

				if (document.exitFullscreen) {
					document.exitFullscreen();
				} else if (document.mozCancelFullScreen) {
					document.mozCancelFullScreen();
				} else if (document.webkitCancelFullScreen) {
					document.webkitCancelFullScreen();
				}

				useOriginalOpenWnd = false;
			}
			/////////////////////////////////////////////////////////////////////////////////


			if (useOriginalOpenWnd == true) {
				generatedWindow = originalWindowOpenFn.apply(this, openWndArguments);
				// save the window by name, for latter use.
				var windowName = getWindowName(openWndArguments);
				if (windowName != null) {
					windowsWithNames[windowName] = generatedWindow;
				}

				// 2nd line of defence: allow window to open but monitor carefully...

				/////////////////////////////////////////////////////////////////////////////////
				// Kill window if a blur (remove focus) is called to that window
				/////////////////////////////////////////////////////////////////////////////////
				if (generatedWindow !== window) {
					(function () {
						var openTime = new Date().getTime();
						var originalWndBlurFn = generatedWindow.blur;
						generatedWindow.blur = function () {
							if (new Date().getTime() - openTime < 1000 /* one second */) {
									window.pbreason = "Blocked a new window opened with URL: " + openWndArguments[0] + " because a it was blured";
									generatedWindow.close();
									blockedWndNotification(openWndArguments);
								} else {
								originalWndBlurFn();
							}
						};
					})();
				}
				/////////////////////////////////////////////////////////////////////////////////
			} else {
				var windowName;

				(function () {
					// (useOriginalOpenWnd == false)

					var location = {
						href: openWndArguments[0]
					};
					location.replace = function (url) {
						location.href = url;
					};

					generatedWindow = {
						close: function close() {
							return true;
						},
						test: function test() {
							return true;
						},
						blur: function blur() {
							return true;
						},
						focus: function focus() {
							return true;
						},
						showModelessDialog: function showModelessDialog() {
							return true;
						},
						showModalDialog: function showModalDialog() {
							return true;
						},
						prompt: function prompt() {
							return true;
						},
						confirm: function confirm() {
							return true;
						},
						alert: function alert() {
							return true;
						},
						moveTo: function moveTo() {
							return true;
						},
						moveBy: function moveBy() {
							return true;
						},
						resizeTo: function resizeTo() {
							return true;
						},
						resizeBy: function resizeBy() {
							return true;
						},
						scrollBy: function scrollBy() {
							return true;
						},
						scrollTo: function scrollTo() {
							return true;
						},
						getSelection: function getSelection() {
							return true;
						},
						onunload: function onunload() {
							return true;
						},
						print: function print() {
							return true;
						},
						open: function open() {
							return this;
						},

						opener: window,
						closed: false,
						innerHeight: 480,
						innerWidth: 640,
						name: openWndArguments[1],
						location: location,
						document: { location: location }
					};

					copyMissingProperties(window, generatedWindow);

					generatedWindow.window = generatedWindow;

					windowName = getWindowName(openWndArguments);

					if (windowName != null) {
						try {
							// originalWindowOpenFn("", windowName).close();
							windowsWithNames[windowName].close();
						} catch (err) {}
					}
					//why set timeout?
					setTimeout(function () {
						var url = void 0;
						if (!(generatedWindow.location instanceof Object)) {
							url = generatedWindow.location;
						} else if (!(generatedWindow.document.location instanceof Object)) {
							url = generatedWindow.document.location;
						} else if (location.href != null) {
							url = location.href;
						} else {
							url = openWndArguments[0];
						}
						openWndArguments[0] = url;
						blockedWndNotification(openWndArguments);
					}, 100);
				})();
			}

			return generatedWindow;
		}

		/////////////////////////////////////////////////////////////////////////////////
		// Replace the window open method with Poper Blocker's
		/////////////////////////////////////////////////////////////////////////////////
		window.open = function () {
			try {
				return newWindowOpenFn.apply(this, arguments);
			} catch (err) {
				return null;
			}
		};
		/////////////////////////////////////////////////////////////////////////////////


		//////////////////////////////////////////////////////////////////////////////////////////////////////////
		// Monitor dynamic html element creation to prevent generating <a> elements with click dispatching event
		//////////////////////////////////////////////////////////////////////////////////////////////////////////
		document.createElement = function () {

			var newElement = originalCreateElementFn.apply(document, arguments);

			if (arguments[0] == "a" || arguments[0] == "A") {
				(function () {

					timeSinceCreateAElement = new Date().getTime();

					var originalDispatchEventFn = newElement.dispatchEvent;

					newElement.dispatchEvent = function (event) {
						if (event.type != null && ("" + event.type).toLocaleLowerCase() == "click") {
							window.pbreason = "blocked due to an explicit dispatchEvent event with type 'click' on an 'a' tag";
							parent.postMessage({
								type: "blockedWindow",
								args: JSON.stringify({ "0": newElement.href })
							}, parentOrigin);
							return true;
						}

						return originalDispatchEventFn(event);
					};

					lastCreatedAElement = newElement;
				})();
			}

			return newElement;
		};
		/////////////////////////////////////////////////////////////////////////////////


		/////////////////////////////////////////////////////////////////////////////////
		// Block artificial mouse click on frashly created <a> elements
		/////////////////////////////////////////////////////////////////////////////////
		document.createEvent = function () {
			try {
				if (arguments[0].toLowerCase().includes("mouse") && new Date().getTime() - timeSinceCreateAElement <= 50) {
					window.pbreason = "Blocked because 'a' element was recently created and " + arguments[0] + " event was created shortly after";
					arguments[0] = lastCreatedAElement.href;
					parent.postMessage({
						type: "blockedWindow",
						args: JSON.stringify({ "0": lastCreatedAElement.href })
					}, parentOrigin);
					return null;
				}
				return originalCreateEventFn.apply(document, arguments);
			} catch (err) {}
		};
		/////////////////////////////////////////////////////////////////////////////////


		/////////////////////////////////////////////////////////////////////////////////
		// Monitor full screen requests
		/////////////////////////////////////////////////////////////////////////////////
		function onFullScreen(isInFullScreenMode) {
			if (isInFullScreenMode) {
				fullScreenOpenTime = new Date().getTime();
			} else {
				fullScreenOpenTime = NaN;
			}
		}

		/////////////////////////////////////////////////////////////////////////////////

		function isDocumentInFullScreenMode() {
			// Note that the browser fullscreen (triggered by short keys) might
			// be considered different from content fullscreen when expecting a boolean
			return document.fullScreenElement && document.fullScreenElement !== null || // alternative standard methods
			document.mozFullscreenElement != null || document.webkitFullscreenElement != null; // current working methods
		}

		document.addEventListener("fullscreenchange", function () {
			onFullScreen(document.fullscreen);
		}, false);

		document.addEventListener("mozfullscreenchange", function () {
			onFullScreen(document.mozFullScreen);
		}, false);

		document.addEventListener("webkitfullscreenchange", function () {
			onFullScreen(document.webkitIsFullScreen);
		}, false);
	}</script><script class="ui-draggable" style="position: relative;">inject()</script></html><!-- Made using Drag Design Plus - http://chrome.google.com/webstore/detail/drag-design/ojakcmmkjeffinjapolfoahfagdgelfk -->