<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<title>psdtowebEditInterfacessssNoneRast329.psd</title>
		<link href="styles.css" rel="stylesheet" type="text/css">
	</head>
	<body>
		<div id="background">
			<div id="Time">
			<span id="minutesSlot">00</span>
			<span id="timeSeparator">:</span>
			<span id="secondsSlot">00</span>
			</div>
			<div id="Pause"><img src="images/Pause.png"></div><span id="minutesSlot"></span>
			<div id="Play"><img src="images/Play.png"></div>

			<div 
			<div id="LabelPeriod"><img src="images/LabelPeriod.png"></div>
			<div id="Period"><h2 class="smallerText">0</h2></div>
			<div id="PeriodDown"><img src="images/PeriodDown.png"></div>
			<div id="PeriodUp"><img src="images/PeriodUp.png"></div>

			<div id="LabelFouls"><img src="images/LabelFouls.png"></div>
			
			<div id="GuestFoulsUp"><img src="images/GuestFoulsUp.png"></div>
			<div id="GuestFoulsDown"><img src="images/GuestFoulsDown.png"></div>
			
			
			<div id="LabelFoulsHome"><img src="images/LabelFouls.png"></div>
			<div id="HomeFoulsUp"><img src="images/HomeFoulsUp.png"></div>
			<div id="HomeFoulsDown"><img src="images/HomeFoulsDown.png"></div>
			
			<div id="HomeLabelTimeouts"><img src="images/HomeLabelTimeouts.png"></div>
			<div id="HomeTimeouts"><h2 class="smallerText">0</h2></div>
			<div id="HomeTimeoutsUp"><img src="images/HomeTimeoutsUp.png"></div>
			<div id="HomeTimeoutsDown"><img src="images/HomeTimeoutsDown.png"></div>
			

			<div id="GuestLabelTimeouts"><img src="images/GuestLabelTimeouts.png"></div>
			<div id="GuestTimeouts"><h2 class="smallerText">0</h2></div>
			<div id="GuestTimeoutsUp"><img src="images/GuestTimeoutsUp.png"></div>
			<div id="GuestTimeoutsDown"><img src="images/GuestTimeoutsDown.png"></div>
			
			<div id="LabelHome"><img src="images/LabelHome.png"></div>
			<div id="HomeScore"><h2 class="Scores">0</h2></div>
			<div id="HomeScoreUp"><img src="images/HomeScoreUp.png"></div>
			<div id="HomeScoreDown"><img src="images/HomeScoreDown.png"></div>
			
			<div id="LabelGuest"><img src="images/LabelGuest.png"></div>
			<div id="ScoreGuest"><h2 class="Scores">0</h2></div>
			<div id="GuestScoreUp"><img src="images/GuestScoreUp.png"></div>
			<div id="GuestScoreDown"><img src="images/GuestScoreDown.png"></div>
			<button id="save"> Save</button>


			<div id="FoulsGuest"><h2 class="smallerText">0</h2></div>

			<div id="FoulsHome"><h2 class="smallerText">000</h2></div>
		</div>

 	<script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
	<script>
	var isPaused;
	var isTextArea;
	var time;
	    $(document).ready(function() {
		        var socket = io();
		        $('#Play').hide();

		        $('#save').hide();



		        //PING
		        /*
				socket.on('disconnect', function(){
				        console.log('user disconnected');
				});
		        setInterval(function() {
  					startTime = Date.now();
  					socket.emit('ping');
				}, 2000);

				socket.on('pong', function() {
				  latency = Date.now() - startTime;
				  console.log(latency);
				});
				*/
				//HOME SCORE		       
		       $('#HomeScoreUp').on('click', function () {		     
		       	var new_score =	 parseScore($('#HomeScore').children('h2').text(),"+");
			       $('#HomeScore').children('h2').html(new_score);
			       socket.emit('HomeScoreChange', new_score); 	         
		       });
		       $('#HomeScoreDown').on('click', function () {		
		       	var new_score =	 parseScore($('#HomeScore').children('h2').text(),"-");
			       $('#HomeScore').children('h2').html(new_score);
			       socket.emit('HomeScoreChange', new_score);       	         
		       });		     
		        socket.on('HomeScoreChange', function(new_score){		         
		          $('#HomeScore').children('h2').html(new_score);
		        });

		        //GUEST SCORE
 				$('#GuestScoreUp').on('click', function () {
		       		var new_score =	 parseScore($('#ScoreGuest').children('h2').text(),"+");
			       $('#ScoreGuest').children('h2').html(new_score);
			       socket.emit('GuestScoreChange', new_score); 		        
		       });
		       $('#GuestScoreDown').on('click', function () {	
			       var new_score =	 parseScore($('#ScoreGuest').children('h2').text(),"-");
			       $('#ScoreGuest').children('h2').html(new_score);
			       socket.emit('GuestScoreChange', new_score); 
		       });		     
		       socket.on('GuestScoreChange', function(new_score){		      		   
		          $('#ScoreGuest').children('h2').html(new_score);
		       });
		       // FOULS HOME
		       	$('#HomeFoulsUp').on('click', function () {
		       		var new_score =	 parseScore($('#FoulsHome').children('h2').text(),"+");
			       $('#FoulsHome').children('h2').html(new_score);
			       socket.emit('HomeFoulChange', new_score); 		        
		       });
		       $('#HomeFoulsDown').on('click', function () {	
			       var new_score =	 parseScore($('#FoulsHome').children('h2').text(),"-");
			       $('#FoulsHome').children('h2').html(new_score);
			       socket.emit('HomeFoulChange', new_score); 
		       });		     
		       socket.on('HomeFoulChange', function(new_score){		      		   
		          $('#FoulsHome').children('h2').html(new_score);
		       });
		       //FOULS GUEST
		       	$('#GuestFoulsUp').on('click', function () {
		       		var new_score =	 parseScore($('#FoulsGuest').children('h2').text(),"+");
			       $('#FoulsGuest').children('h2').html(new_score);
			       socket.emit('GuestFoulChange', new_score); 		        
		       });
		       $('#GuestFoulsDown').on('click', function () {	
			       var new_score =	 parseScore($('#FoulsGuest').children('h2').text(),"-");
			       $('#FoulsGuest').children('h2').html(new_score);
			       socket.emit('GuestFoulChange', new_score); 
		       });		     
		       socket.on('GuestFoulChange', function(new_score){		      		   
		          $('#FoulsGuest').children('h2').html(new_score);
		       });
		       // TIMEOUTS HOME
		       	$('#HomeTimeoutsUp').on('click', function () {
		       		var new_score =	 parseScore($('#HomeTimeouts').children('h2').text(),"+");
			       $('#HomeTimeouts').children('h2').html(new_score);
			       socket.emit('HomeTimeoutChange', new_score); 		        
		       });
		       $('#HomeTimeoutsDown').on('click', function () {	
			       var new_score =	 parseScore($('#HomeTimeouts').children('h2').text(),"-");
			       $('#HomeTimeouts').children('h2').html(new_score);
			       socket.emit('HomeTimeoutChange', new_score); 
		       });		     
		       socket.on('HomeTimeoutChange', function(new_score){		      		   
		          $('#HomeTimeouts').children('h2').html(new_score);
		       });

		       //Timeouts Guest
		       	$('#GuestTimeoutsUp').on('click', function () {
		       		var new_score =	 parseScore($('#GuestTimeouts').children('h2').text(),"+");
			       $('#GuestTimeouts').children('h2').html(new_score);
			       socket.emit('GuestTimeoutChange', new_score); 		        
		       });
		       $('#GuestTimeoutsDown').on('click', function () {	
			       var new_score =	 parseScore($('#GuestTimeouts').children('h2').text(),"-");
			       $('#GuestTimeouts').children('h2').html(new_score);
			       socket.emit('GuestTimeoutChange', new_score); 
		       });		     
		       socket.on('GuestTimeoutChange', function(new_score){		      		   
		          $('#GuestTimeouts').children('h2').html(new_score);
		       });

		       // PEROIOD
		       	$('#PeriodDown').on('click', function () {
		       		var new_score =	 parseScore($('#Period').children('h2').text(),"+");
			       $('#Period').children('h2').html(new_score);
			       socket.emit('PeriodChange', new_score); 		        
		       });
		       $('#PeriodUp').on('click', function () {	
			       var new_score =	 parseScore($('#Period').children('h2').text(),"-");
			       $('#Period').children('h2').html(new_score);
			       socket.emit('PeriodChange', new_score); 
		       });		     
		       socket.on('PeriodChange', function(new_score){		      		   
		          $('#Period').children('h2').html(new_score);
		       });		       

		       socket.on("TimePlay", function(newtime){
		       	time = newtime;
		       		Play();
		       });
		       
		       
		       socket.on('TimePause', function(newtime){
		       	time = newtime;
				Pause();
		       });
		       	
		    	socket.on('TimeChange', function(newtime){
		    		time = newtime;
		    	});


		        $('#Pause').click(function(){
					if(isTextArea)
		        		return
					console.log('puase clicked');
					socket.emit("TimePause", time);
					Pause();
		       	

		        });

		        $('#Play').click(function(){
		        	if(isTextArea){
		        		return
		        	}
					console.log('Play clicked');
					socket.emit('TimePlay', time);
					Play();	       
		        });

				$('#minutesSlot').click(function(){
					if(isTextArea){
		        		return
		        	}
					Pause();
					
					ToTextArea('minutesSlot');
					ToTextArea('secondsSlot');
				});

				$('#secondsSlot').click(function(){
					if(isTextArea){
		        		return
		        	}
					
					Pause();
					ToTextArea('secondsSlot');
					ToTextArea('minutesSlot');
				});

				$('#save').click(function(){
					Save();

				});

		       function parseScore(socoreText, operation) {
		          var old_score_int = parseInt(socoreText);
		          if (operation == "+"){var new_score = old_score_int + 1};
		          if (operation == "-"){var new_score = old_score_int - 1};
		          if(new_score < 0){new_score = 0};
		          
		          return new_score;
		        }

		        document.addEventListener('gesturestart', function (e) {
    				e.preventDefault();
				});



		    function Save (){
					$('#save').fadeOut();
					var minutesSlotText = $('.textminutesSlot').val();	
					var secondsSlotText = $('.textsecondsSlot').val();
					if(isNaN(parseInt(secondsSlotText))){
						secondsSlotText = "0"
					}
					if(isNaN(parseInt(minutesSlotText))){
						minutesSlotText = "0"
					}
					var finalMiliseconds = (parseInt(minutesSlotText) * 60000) + (parseInt(secondsSlotText) * 1000);
					
					time = finalMiliseconds;
					Play();
					
					isTextArea = false;
					$('#Time').css("left", "251px");
					$('#Time').css("top", "69px");
					socket.emit('TimeChange', time);
			}

	    });
function Pause(){
	$('#Pause').fadeOut();
	$('#Play').fadeIn();
	isPaused=true;
	
}
function Play(){
	$('#Play').fadeOut();
	$('#Pause').fadeIn();
	isPaused=false;
	
}	
// TODO HAVE THE TEXT AREA BE THE SAME SECONDS ASAND MINETS AS BEFORE
function ToTextArea(id){
	if(isTextArea)
		return;
	$('#Play').hide();
	$('#Pause').hide();
	$('#save').show();
	$('#Time').css("left", "138px");
	$('#Time').css("top", "-1px");
	
	
	isTextArea = true;
	var textm = $('#minutesSlot').text();
	var texts = $('#secondsSlot').text();
	$('#secondsSlot').html('<textarea class="textsecondsSlot">' + texts+'</textarea>');
	$('#minutesSlot').html('<textarea class="textminutesSlot">'+textm+' </textarea>');
}


		setInterval(function(){
		if(isPaused){
			return
		}
		if(Math.floor(time - 10) <= 0){time = 0}else{
			time = time - 10;
		}
		
		
	}, 10);


//TODO change the times postion if double digits
	setInterval(function(){
		if(isTextArea){
			return
		}
		var timeObject =  convertMillisecondsToDigitalClock(time);
	
		$('#minutesSlot').text(timeObject.minutes);
		$('#secondsSlot').text(timeObject.seconds);

	}, 100);



	// CONVERT MILLISECONDS TO DIGITAL CLOCK FORMAT
	function convertMillisecondsToDigitalClock(ms) {
	    var hours = Math.floor(ms / 3600000); // 1 Hour = 36000 Milliseconds
	    var minutes = Math.floor((ms % 3600000) / 60000); // 1 Minutes = 60000 Milliseconds
	    var seconds = Math.floor(((ms % 360000) % 60000) / 1000) ;	// 1 Second = 1000 Milliseconds
	    var tenthseconds = Math.floor((((ms % 360000) % 60000) % 1000) / 100);
	    var miliseconds = (((ms % 360000) % 60000) % 1000);
	        return {
		        hours : hours,
		        minutes : minutes,
		        seconds : seconds,
		        miliseconds:miliseconds,
		        tenthseconds: tenthseconds,
		        clock : hours + ":" + minutes + ":" + seconds + "." + tenthseconds
	    	};
	}



    </script>
 </body>
 </html>